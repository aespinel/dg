define(["require","framework/controllers/Controller","framework/ViewRenderer","jquery","libs/external/jquery.blockUI","libs/external/select2","libs/external/highcharts","datatables","app/libs/DistrictDataFeed","app/libs/BlockDataFeed","app/libs/VrpPaymentDataFeed","TableTools","text!app/views/district.html","text!app/views/block.html"],function(e){var t=e("framework/controllers/Controller"),n=e("framework/ViewRenderer"),r=e("jquery"),i=e("libs/external/jquery.blockUI"),s=e("libs/external/select2"),o=e("libs/external/highcharts"),u=e("datatables"),a=e("app/libs/DistrictDataFeed"),f=e("app/libs/BlockDataFeed"),l=e("app/libs/VrpPaymentDataFeed"),c=e("TableTools"),h=e("text!app/views/district.html"),p=e("text!app/views/block.html"),d=t.extend({constructor:function(e){return this.base(e),this.initSelect2(),this},_initReferences:function(e){this.base();var t=this._references;t.districtdataFeed=new a,t.blockdataFeed=new f,t.vrppaymentdataFeed=new l,t.$analyticsWrapper=e,t.$districtContainer=e.find(".js-district-container"),t.$blockContainer=e.find(".js-block-container"),t.$goButton=e.find(".js-go-btn"),t.$partnerList=e.find(".js-partnerlist"),t.$loadingTable=e.find("#loading"),t.$reportTable=e.find("#paymenttable"),t.$startPeriod=e.find(".js-startperiod"),t.$endPeriod=e.find(".js-endperiod"),t.$starExplanation=e.find(".js-explanation")},_initEvents:function(){this.base();var e=this._boundFunctions,t=this._references;e.onDistrictDataProcessed=this._onDistrictDataProcessed.bind(this),t.districtdataFeed.on("dataProcessed",e.onDistrictDataProcessed),e.onBlockDataProcessed=this._onBlockDataProcessed.bind(this),t.blockdataFeed.on("dataProcessed",e.onBlockDataProcessed),e.onVrpPaymentDataProcessed=this._onVrpPaymentDataProcessed.bind(this),t.vrppaymentdataFeed.on("dataProcessed",e.onVrpPaymentDataProcessed),e.onGoBtnClick=this._onGoBtnClick.bind(this),t.$goButton.on("click",e.onGoBtnClick),e.onPartnerChosen=this._onPartnerChosen.bind(this),t.$partnerList.on("change",this._boundFunctions.onPartnerChosen)},getDistrict:function(){var e=this._references.districtdataFeed.getDistrict();if(e==0)return!1;this._renderDistrict(e),this.initSelect2()},getBlock:function(){var e=this._references.blockdataFeed.getBlock();if(e==0)return!1;this._renderBlock(e),this.initSelect2()},_onDistrictDataProcessed:function(){this.getDistrict()},_onBlockDataProcessed:function(){this.getBlock()},_onVrpPaymentDataProcessed:function(){this.makeReport()},_renderDistrict:function(e){var t=this._references,i={district:e},s=n.render(h,i);this._references.$districtContainer.html(s),t.$districtList=r(".js-districtlist"),this._boundFunctions.onDistrictChosen=this._onDistrictChosen.bind(this),t.$districtList.on("change",this._boundFunctions.onDistrictChosen)},_renderBlock:function(e){var t=this._references,i={block:e},s=n.render(p,i);this._references.$blockContainer.html(s),t.$blockList=r(".js-blocklist")},initSelect2:function(){var e=this._references;try{$(".chosen-select").select2({no_results_text:"No results match",width:"100%",placeholder:"Choose Block"})}catch(t){$("select.chosen-select").select2({no_results_text:"No results match",width:"100%",placeholder:"Choose Block"})}},_onPartnerChosen:function(){var e=this._references;e.$partnerList.val()!=""&&(e.districtdataFeed.addInputParam("limit",!1,0),e.districtdataFeed.setInputParam("limit",0,!1),e.districtdataFeed.addInputParam("partner",!1,e.$partnerList.val()),e.districtdataFeed.setInputParam("partner",e.$partnerList.val(),!1),this.getDistrict())},_onDistrictChosen:function(){var e=this._references;e.$districtList.val()!=""&&(e.blockdataFeed.addInputParam("limit",!1,0),e.blockdataFeed.setInputParam("limit",0,!1),e.blockdataFeed.addInputParam("partner",!1,e.$partnerList.val()),e.blockdataFeed.setInputParam("partner",e.$partnerList.val(),!1),e.blockdataFeed.addInputParam("district",!1,e.$districtList.val()),e.blockdataFeed.setInputParam("district",e.$districtList.val(),!1),this.getBlock())},_onGoBtnClick:function(e){e.preventDefault();var t=this._references;t.$startPeriod.val()==""||t.$endPeriod.val()==""||t.$partnerList.val()==""||t.$districtList.val()==""||t.$blockList.val()==""?alert("Information Incomplete! Please fill missing entries"):($(document).ready(function(){$.blockUI({css:{border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#ffffff"}})}),t.$blockList.val()!=""&&(t.vrppaymentdataFeed.addInputParam("limit",!1,0),t.vrppaymentdataFeed.setInputParam("limit",0,!1),t.vrppaymentdataFeed.addInputParam("partner",!1,t.$partnerList.val()),t.vrppaymentdataFeed.setInputParam("partner",t.$partnerList.val(),!1),t.vrppaymentdataFeed.addInputParam("district",!1,t.$districtList.val()),t.vrppaymentdataFeed.setInputParam("district",t.$districtList.val(),!1),t.vrppaymentdataFeed.addInputParam("block",!1,t.$blockList.val()),t.vrppaymentdataFeed.setInputParam("block",t.$blockList.val(),!1),t.vrppaymentdataFeed.addInputParam("startperiod",!1,t.$startPeriod.val()),t.vrppaymentdataFeed.setInputParam("startperiod",t.$startPeriod.val(),!1),t.vrppaymentdataFeed.addInputParam("endperiod",!1,t.$endPeriod.val()),t.vrppaymentdataFeed.setInputParam("endperiod",t.$endPeriod.val(),!1),this.makeReport()))},makeReport:function(){var e=this._references.vrppaymentdataFeed.getReport();if(e==0)return!1;this._renderReport(e)},_renderReport:function(e){var t=this._references;$.unblockUI();var n={report:e};console.log("data is: ",n),r(t.$starExplanation).removeClass("hidden"),t.$reportTable.DataTable({sDom:'T<"clear">lfrtip',destroy:!0,bAutoWidth:!1,aoColumns:[{sTitle:"S.No"},{sTitle:"Name"},{sTitle:"Village"},{sTitle:"Total Screenings"},{sTitle:"Successful Screening *"},{sTitle:"Successful Video Adoptions **"},{sTitle:"Amount"}],aaData:n.report,oTableTools:{sSwfPath:"/media/social_website/scripts/libs/tabletools_media/swf/copy_csv_xls.swf"}})},setInputParam:function(e,t,n){this._references.dataFeed.setInputParam(e,t,n)},_onInputParamChanged:function(){this.getCollectionDropDown()},destroy:function(){this.base()}});return d});